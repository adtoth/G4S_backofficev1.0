sap.ui.controller("sap.ui.demo.myFiori.view.App", {
	
	/**
	 * Navigates to another page
	 * @param {string} pageId The id of the next page
	 * @param {sap.ui.model.Context} context The data context to be applied to the next page (optional)
	 */
	to : function (pageId, context) {
		
		var app = this.getView().app;
		
		// load page on demand
		var master = ("Master" === pageId);
		if (app.getPage(pageId, master) === null) {
			var page = sap.ui.view({
				id : pageId,
				viewName : "sap.ui.demo.myFiori.view." + pageId,
				type : "XML"
			});
			page.getController().nav = this;
			app.addPage(page, master);
			jQuery.sap.log.info("app controller > loaded page: " + pageId);
		}
		
		$(document).ajaxError(function(event, request, settings) {

			  switch (request.status) {

			  case 0:
			    jQuery.sap.require("sap.m.MessageToast");
			    sap.m.MessageToast.show("No connection", {duration: 1000});
			    break;

			  case 201:

			    var LoginStatus = request.getResponseHeader("SAPLoginStatus");

			    switch (LoginStatus) {

			    case "Logon":
			      UI5Logon();
			      break;

			    case "Password":
			      jQuery.sap.require("sap.m.MessageToast");
			      sap.m.MessageToast.show("Need to change password", {duration: 1000});
			      break;

			    }

			    break;

			  case 200:
			    UI5Logon();
			    break;

			  case 404:
			    break;

			  default:
			    jQuery.sap.require("sap.m.MessageToast");
			    sap.m.MessageToast.show(request.status + " - " + request.statusText, {duration: 1000});

			  }

			});
		
		// show the page
		app.to(pageId);
		
		// set data context on the page
		if (context) {
			var page = app.getPage(pageId);
			page.setBindingContext(context);
		}
	},
	
	/**
	 * Navigates back to a previous page
	 * @param {string} pageId The id of the next page
	 */
	back : function (pageId) {	
		this.getView().app.backToPage(pageId);
		
	}
});